IPT="iptables"
WAN="eth0"
VPN="wg+"
WANPORTS="49156 1194 53 139 445"
VPNPORTS="49156 80 443  8082 53 16384:32768"

VPN_NET="10.8.0.0/24"
WAN_NET="10.0.0.20/32"
VPN_GW="10.8.0.254"

TELEGRAM="149.154.164.0/22 149.154.172.0/22 91.108.4.0/22 91.108.56.0/24"
FACEBOOK="102.132.96.0/20 102.132.96.0/24 103.4.96.0/22 129.134.0.0/17 129.134.25.0/24 129.134.26.0/24 129.134.27.0/24 129.134.28.0/24 129.134.29.0/24 129.134.30.0/23 129.134.30.0/24 129.134.31.0/24 157.240.0.0/17 157.240.10.0/24 157.240.1.0/24 157.240.11.0/24 157.240.12.0/24 157.240.13.0/24 157.240.14.0/24 157.240.15.0/24 157.240.17.0/24 157.240.18.0/24 157.240.19.0/24 157.240.192.0/18 157.240.193.0/24 157.240.194.0/24 157.240.195.0/24 157.240.196.0/24 157.240.200.0/24 157.240.20.0/24 157.240.201.0/24 157.240.2.0/24 157.240.203.0/24 157.240.204.0/24 157.240.206.0/24 157.240.207.0/24 157.240.209.0/24 157.240.210.0/24 157.240.21.0/24 157.240.212.0/24 157.240.215.0/24 157.240.216.0/24 157.240.217.0/24 157.240.218.0/24 157.240.220.0/24 157.240.22.0/24 157.240.221.0/24 157.240.222.0/24 157.240.223.0/24 157.240.26.0/24 157.240.27.0/24 157.240.28.0/24 157.240.29.0/24 157.240.30.0/24 157.240.3.0/24 157.240.6.0/24 157.240.7.0/24 157.240.8.0/24 157.240.9.0/24 173.252.64.0/19 173.252.88.0/21 173.252.96.0/19 179.60.192.0/22 179.60.192.0/24 179.60.193.0/24 179.60.194.0/24 179.60.195.0/24 185.60.216.0/22 185.60.216.0/24 185.60.217.0/24 185.60.218.0/24 185.60.219.0/24 185.89.218.0/23 185.89.218.0/24 185.89.219.0/24 204.15.20.0/22 31.13.24.0/21 31.13.64.0/18 31.13.64.0/19 31.13.64.0/24 31.13.65.0/24 31.13.66.0/24 31.13.67.0/24 31.13.70.0/24 31.13.71.0/24 31.13.72.0/24 31.13.73.0/24 31.13.74.0/24 31.13.76.0/24 31.13.77.0/24 31.13.80.0/24 31.13.81.0/24 31.13.82.0/24 31.13.83.0/24 31.13.84.0/24 31.13.85.0/24 31.13.86.0/24 31.13.87.0/24 31.13.89.0/24 31.13.92.0/24 31.13.93.0/24 31.13.94.0/24 31.13.95.0/24 31.13.96.0/19 45.64.40.0/22 66.220.144.0/20 66.220.144.0/21 66.220.152.0/21 69.171.224.0/19 69.171.224.0/20 69.171.239.0/24 69.171.240.0/20 69.171.250.0/24 69.171.255.0/24 69.63.176.0/20 69.63.176.0/21 69.63.184.0/21 74.119.76.0/22"
WHATSAPP="31.13.64.51/32 31.13.64.53/32 31.13.65.49/32 31.13.65.50/32 31.13.66.51/32 31.13.66.56/32 31.13.67.52/31 31.13.68.48/32 31.13.68.52/32 31.13.70.49/32 31.13.70.50/32 31.13.71.49/32 31.13.71.50/32 31.13.72.48/32 31.13.72.52/32 31.13.73.52/31 31.13.74.52/31 31.13.79.53/32 31.13.79.54/32 31.13.80.48/32 31.13.80.53/32 31.13.81.48/32 31.13.81.53/32 31.13.82.51/32 31.13.82.55/32 31.13.83.49/32 31.13.83.51/32 31.13.84.49/32 31.13.84.51/32 31.13.85.49/32 31.13.85.51/32 31.13.86.49/32 31.13.86.51/32 31.13.87.48/32 31.13.87.51/32 31.13.89.53/32 31.13.89.54/32 31.13.90.49/32 31.13.90.51/32 31.13.91.49/32 31.13.91.51/32 31.13.92.48/32 31.13.92.52/32 31.13.93.53/32 31.13.93.54/32 31.13.94.52/32 31.13.94.54/32 31.13.95.50/32 31.13.95.63/32 50.22.240.160/27 50.23.90.128/27 69.171.239.11/32 69.171.250.52/32 69.171.250.54/32 69.171.255.11/32 102.132.96.54/31 102.132.97.54/31 108.168.174.0/27 108.168.176.192/26 108.168.177.0/27 108.168.180.96/27 108.168.254.65/32 108.168.255.224/32 108.168.255.227/32 157.240.1.53/32 157.240.1.54/32 157.240.2.53/32 157.240.2.54/32 157.240.3.54/31 157.240.6.53/32 157.240.6.54/32 157.240.7.53/32 157.240.7.54/32 157.240.8.53/32 157.240.8.54/32 157.240.9.53/32 157.240.9.54/32 157.240.10.53/32 157.240.10.54/32 157.240.11.53/32 157.240.11.54/32 157.240.12.53/32 157.240.12.54/32 157.240.13.54/31 157.240.14.52/31 157.240.15.53/32 157.240.15.54/32 157.240.16.52/31 157.240.18.52/31 157.240.19.53/32 157.240.19.54/32 157.240.20.52/31 157.240.21.52/31 157.240.22.53/32 157.240.22.54/32 157.240.23.53/32 157.240.23.54/32 157.240.24.54/31 157.240.25.54/31 157.240.26.54/31 157.240.27.54/31 157.240.28.51/32 157.240.28.55/32 157.240.29.53/32 157.240.29.54/32 157.240.30.54/31 157.240.192.52/32 157.240.192.55/32 157.240.193.50/32 157.240.193.55/32 157.240.194.54/31 157.240.195.54/32 157.240.195.56/32 157.240.196.60/31 157.240.201.60/31 158.85.0.96/27 158.85.5.192/27 158.85.46.128/27 158.85.48.224/27 158.85.58.32/27 158.85.58.96/27 158.85.61.192/27 158.85.224.160/27 158.85.233.32/27 169.44.36.0/26 169.44.80.32/27 169.44.82.96/27 169.44.84.128/27 169.45.71.32/27 169.45.87.128/27 169.45.169.192/27 169.45.210.64/27 169.45.214.224/27 169.45.219.224/27 169.45.238.32/27 169.45.242.192/26 169.45.248.96/27 169.45.248.160/27 169.47.5.192/26 169.47.6.64/27 169.47.35.32/27 169.47.40.128/27 169.47.42.96/27 169.47.42.160/27 169.47.42.192/26 169.47.130.96/27 169.47.153.128/25 169.47.198.128/27 169.47.212.160/27 169.53.71.224/27 169.53.81.64/27 169.54.51.32/27 169.54.55.192/27 169.54.222.128/27 169.55.60.148/32 169.55.60.170/32 169.55.67.224/27 169.55.69.160/27 169.55.74.32/27 169.55.75.96/27 169.60.75.128/25 169.60.79.0/24 169.60.147.0/24 169.61.101.0/24 169.62.159.16/28 169.63.64.128/28 169.63.73.32/27 169.63.73.64/26 169.63.76.0/25 173.192.162.32/27 173.192.222.160/27 173.193.230.128/27 173.193.239.0/27 174.36.208.128/27 174.36.210.32/27 174.37.243.64/27 179.60.192.49/32 179.60.192.51/32 179.60.193.52/31 179.60.194.53/32 179.60.194.54/32 179.60.195.49/32 179.60.195.51/32 184.173.136.64/27 184.173.147.32/27 184.173.161.64/32 184.173.173.116/32 185.60.216.53/32 185.60.216.54/32 185.60.217.53/32 185.60.217.54/32 185.60.218.53/32 185.60.218.54/32 185.60.219.53/32 185.60.219.54/32 192.155.212.192/27 198.11.193.182/31 198.11.251.32/27 198.23.80.0/27 208.43.115.192/27"
INSTA="3.226.99.60 3.224.0.0/12 34.231.173.234 34.224.0.0/12 3.91.121.236 3.80.0.0/12 3.216.119.158 3.208.0.0/12 34.195.221.54 34.192.0.0/12 34.196.209.8 34.192.0.0/12 34.199.142.235 34.192.0.0/12 34.206.62.254 34.192.0.0/12"
TWITTER="104.244.42.65 104.244.42.0/24 104.244.42.129 104.244.42.0/24"
GOOGLE="172.217.0.46 172.217.0.0/24 172.217.0.46 172.217.0.0/16"
SC="13.227.64.45 13.227.64.0/22 13.227.64.53 13.227.64.0/22 13.227.64.60 13.227.64.0/22 13.227.64.37 13.227.64.0/22 13.224.203.40 13.224.203.41 13.224.203.48 13.224.203.58"

$IPT -P INPUT DROP
$IPT -P FORWARD ACCEPT
$IPT -P OUTPUT DROP

$IPT -A INPUT -i lo -j ACCEPT
$IPT -A OUTPUT -o lo -j ACCEPT








for w in $WANPORTS
do

$IPT -A INPUT  -p tcp -m tcp --dport $w -j ACCEPT

$IPT -A INPUT   -p udp -m udp  --dport $w -j ACCEPT

done

# $IPT -A FORWARD  -m conntrack --ctstate NEW,RELATED,ESTABLISHED   -j ACCEPT

for v in $VPNPORTS
do 
 
$IPT -A INPUT  -i $VPN  -p tcp -m tcp   --dport $v -j ACCEPT
$IPT -A INPUT  -i $VPN   -p udp -m udp  --dport $v -j ACCEPT


 done 
iptables -N scblock
for  sc  in $SC
do
iptables -A scblock -d $sc -j DROP
done 


iptables -N googleblock
for  go  in $GOOGLE
do
iptables -A googleblock -d $go -j DROP
done 

iptables -N twitterblock
for  tw  in $TWITTER
do
iptables -A twitterblock -d $tw -j DROP
done 

iptables -N instablock
for in in $INSTA
do
iptables -A instablock -d $in -j DROP
done 


iptables -N fbblock
for f in $FACEBOOK
do
iptables -A fbblock -d $f -j DROP
 done 

iptables -N telegram-blacklist
for t in $TELEGRAM 
do 
iptables -A telegram-blacklist -d $t -j DROP
done

iptables -N whatsappblock
for w in $WHATSAPP
do
iptables -A whatsappblock -d $w -j DROP
done 

iptables -I FORWARD 1  -j telegram-blacklist
iptables -I FORWARD 1  -j whatsappblock
iptables -I FORWARD 1  -j fbblock
iptables -I FORWARD 1  -j instablock
iptables -I FORWARD 1  -j twitterblock
iptables -I FORWARD 1  -j googleblock
iptables -I FORWARD 1  -j scblock








$IPT -t nat -A PREROUTING -s 10.8.0.0/24 -i $VPN -p tcp -m tcp --dport 80 -j DNAT --to-destination 10.8.0.254:80
$IPT -t nat -A PREROUTING -s 10.8.0.0/24 -i $VPN -p tcp -m tcp --dport 443 -j DNAT --to-destination 10.8.0.254:443
$IPT -t nat -A PREROUTING -s 10.8.0.0/24 -i $VPN -p tcp -m tcp -d 0/0 --dport 8082 -j DNAT --to-destination 10.8.0.254:8082
$IPT -t nat -A PREROUTING -s 10.8.0.0/24 -i $VPN -p tcp -m tcp --dport 53 -j DNAT --to-destination 10.8.0.254:53
$IPT -t nat -A PREROUTING -s 10.8.0.0/24 -i $VPN -p udp -m udp --dport 53 -j DNAT --to-destination 10.8.0.254:53
$IPT -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0  -j MASQUERADE

$IPT -I OUTPUT -o eth0   -d 0.0.0.0/0 -j ACCEPT
$IPT -I INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT

$IPT -I OUTPUT  -o $VPN  -d 0.0.0.0/0 -j ACCEPT
$IPT -I INPUT -i $VPN  -m state --state ESTABLISHED,RELATED -j ACCEPT



